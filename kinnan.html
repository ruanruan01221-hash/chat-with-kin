<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ChatGPT èŠå¤©è®°å½•æŸ¥çœ‹å™¨</title>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<style>
body {
  margin: 0;
  font-family: "PingFang SC", "Microsoft YaHei", sans-serif;
  background-color: #fef6fb;
  display: flex;
  height: 100vh;
  overflow: hidden;
}
#sidebar {
  width: 250px;
  background: linear-gradient(180deg, #ffd6ec, #ffe6f7);
  border-right: 2px solid #f3bdd2;
  padding: 15px;
  box-sizing: border-box;
  overflow-y: auto;
}
#sidebar h2 {
  text-align: center;
  color: #b54a74;
  font-size: 18px;
  margin-bottom: 10px;
}
#chatList {
  list-style: none;
  padding: 0;
  margin: 0;
}
#chatList li {
  padding: 8px 10px;
  margin-bottom: 6px;
  background-color: #fff4fa;
  border-radius: 10px;
  cursor: pointer;
  transition: background 0.2s;
}
#chatList li:hover {
  background-color: #ffe1ef;
}
#chatList li.active {
  background-color: #ffb6d9;
  color: white;
}
#main {
  flex: 1;
  display: flex;
  flex-direction: column;
  background-image: url('https://i.imgur.com/rvRYT0L.jpg');
  background-size: cover;
  background-position: center;
  backdrop-filter: blur(5px);
}
#chatContainer {
  flex: 1;
  padding: 15px;
  overflow-y: auto;
  background-color: rgba(255, 255, 255, 0.65);
  border-radius: 15px;
  margin: 10px;
}
.message {
  margin-bottom: 15px;
  display: flex;
  align-items: flex-start;
  max-width: 80%;
}
.message.user {
  flex-direction: row-reverse;
  align-self: flex-end;
  text-align: right;
}
.message.assistant {
  align-self: flex-start;
  text-align: left;
}
.avatar {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  margin: 0 10px;
  object-fit: cover;
}
.bubble {
  border-radius: 12px;
  padding: 10px 15px;
  line-height: 1.5;
  background-color: #ffffff;
  border: 1px solid #f6cadd;
  max-width: 100%;
}
.user .bubble {
  background-color: #ffdeef;
}
.timestamp {
  font-size: 11px;
  color: #999;
  margin-bottom: 3px;
}
#controls {
  padding: 10px;
  background-color: #ffe6f5;
  border-top: 1px solid #f3bdd2;
  text-align: center;
}
input[type="file"] {
  display: none;
}
label.upload-btn {
  background-color: #ffb6d9;
  color: white;
  padding: 8px 20px;
  border-radius: 20px;
  cursor: pointer;
  font-weight: bold;
}
label.upload-btn:hover {
  background-color: #ff9fc9;
}
</style>
</head>
<body>

<div id="sidebar">
  <h2>èŠå¤©çª—å£</h2>
  <ul id="chatList"></ul>
</div>

<div id="main">
  <div id="chatContainer"><p style="text-align:center;color:#b54a74;">è¯·å…ˆä¸Šä¼  JSON æ–‡ä»¶ ğŸ“‚</p></div>
  <div id="controls">
    <input type="file" id="fileInput" accept=".json">
    <label for="fileInput" class="upload-btn">ä¸Šä¼ èŠå¤©è®°å½•</label>
  </div>
</div>

<script>
let chats = [];
const userAvatar = 'https://i.imgur.com/w6XyKQO.png'; // ç”¨æˆ·å¤´åƒï¼Œå¯è‡ªè¡Œæ›´æ¢
const assistantAvatar = 'https://i.imgur.com/7yUvePI.png'; // åŠ©æ‰‹å¤´åƒï¼Œå¯è‡ªè¡Œæ›´æ¢

document.getElementById("fileInput").addEventListener("change", function(e) {
  const file = e.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = function(event) {
    try {
      const data = JSON.parse(event.target.result);
      chats = data.map((c, i) => ({ id: i, title: c.title || "æœªå‘½åèŠå¤©", messages: c.mapping }));
      renderChatList();
    } catch (err) {
      alert("æ–‡ä»¶æ ¼å¼é”™è¯¯æˆ–è§£æå¤±è´¥ï¼");
    }
  };
  reader.readAsText(file);
});

function renderChatList() {
  const list = document.getElementById("chatList");
  list.innerHTML = "";
  chats.forEach(chat => {
    const li = document.createElement("li");
    li.textContent = chat.title;
    li.onclick = () => {
      document.querySelectorAll("#chatList li").forEach(l => l.classList.remove("active"));
      li.classList.add("active");
      renderMessages(chat.messages);
    };
    list.appendChild(li);
  });
}

function renderMessages(messages) {
  const container = document.getElementById("chatContainer");
  container.innerHTML = "";
  const msgList = Object.values(messages)
    .filter(m => m.message && (m.message.role === "user" || m.message.role === "assistant"))
    .filter(m => m.message.content?.parts?.[0]?.trim() !== "")
    .map(m => ({
      role: m.message.role,
      time: new Date(m.message.create_time * 1000).toLocaleString('zh-CN', { hour12: false }),
      text: m.message.content.parts[0]
    }));
  msgList.forEach(msg => {
    const div = document.createElement("div");
    div.className = `message ${msg.role}`;

    const avatar = document.createElement("img");
    avatar.className = "avatar";
    avatar.src = msg.role === 'user' ? userAvatar : assistantAvatar;

    const bubble = document.createElement("div");
    bubble.className = "bubble";
    bubble.innerHTML = `<span class='timestamp'>${msg.time}</span>` + marked.parse(msg.text);

    div.appendChild(avatar);
    div.appendChild(bubble);
    container.appendChild(div);
  });
  container.scrollTop = container.scrollHeight;
}
</script>
</body>
</html>