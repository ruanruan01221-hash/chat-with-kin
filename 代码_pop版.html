<!doctype html><html lang=zh-CN><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>ChatGPT èŠå¤©è®°å½•æŸ¥çœ‹å™¨</title><style>:root{--bg:#faf7ff;--card:#ffffff;--text:#2b2b2b;--muted:#7d7d7d;--brand:#8b5cf6;--accent:#22d3ee;--accent-2:#f472b6;--accent-3:#34d399;--bubble-user:linear-gradient(135deg, #ffd1dc, #ffe4f3, #e3f7ff);--shadow:0 10px 25px rgba(0, 0, 0, .07);--radius:16px;--sidebar-w:300px;--wm-owner:"å¼¥é›…Miaaa@RedNote"}*{box-sizing:border-box}body,html{height:100%;overflow-x:hidden}body{margin:0;background:radial-gradient(1000px 600px at 10% -10%,#fff7fb,transparent),radial-gradient(900px 700px at 120% -20%,#f0fbff,transparent),var(--bg);color:var(--text);font:15px/1.6 ui-sans-serif,-apple-system,BlinkMacSystemFont,"PingFang SC","Noto Sans CJK SC",Inter,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji"}.app{display:grid;grid-template-columns:var(--sidebar-w,300px) minmax(0,1fr);height:100vh;overflow-x:hidden}header{position:sticky;top:0;z-index:5;display:flex;align-items:center;gap:8px;padding:8px 6px;background:linear-gradient(90deg,rgba(139,92,246,.08),rgba(34,211,238,.08) 60%,rgba(244,114,182,.08));backdrop-filter:blur(6px);border-bottom:1px solid rgba(0,0,0,.06)}.toggle{display:none;align-items:center;justify-content:center;width:32px;height:32px;border-radius:9px;border:1px solid rgba(0,0,0,.08);background:#fff;cursor:pointer;transition:all .2s ease;box-shadow:0 1px 3px rgba(0,0,0,.1)}.toggle:hover{background:#f8f9fa;border-color:rgba(0,0,0,.15);box-shadow:0 2px 6px rgba(0,0,0,.15)}.toggle:active{transform:scale(.95)}.toggle .hamburger{display:flex;flex-direction:column;gap:3px;width:16px;height:12px}.toggle .hamburger span{width:100%;height:2px;background:var(--text);border-radius:1px;transition:all .3s ease}.sidebar.open~.main .toggle .hamburger span:first-child{transform:rotate(45deg) translate(4px,4px)}.sidebar.open~.main .toggle .hamburger span:nth-child(2){opacity:0}.sidebar.open~.main .toggle .hamburger span:nth-child(3){transform:rotate(-45deg) translate(4px,-4px)}.brand{font-weight:700;letter-spacing:.3px}.sidebar{background:linear-gradient(160deg,#fff,#fff6fb 30%,#f4fbff 80%);border-right:1px solid rgba(0,0,0,.06);overflow:auto}.side-inner{padding:14px}.picker{display:grid;gap:10px;margin-bottom:12px;background:var(--card);padding:12px;border-radius:var(--radius);box-shadow:var(--shadow)}.picker label{font-size:12px;color:var(--muted)}.picker .btn{display:flex;gap:8px;align-items:center;justify-content:center;padding:10px 12px;border-radius:12px;border:1px dashed rgba(0,0,0,.12);background:linear-gradient(135deg,#fff,#f9fbff);cursor:pointer}.picker .btn:hover{border-color:rgba(0,0,0,.2)}.picker input{display:none}.search{position:relative;margin:10px 0}.search input{width:100%;padding:10px 12px 10px 36px;padding-right:40px;border-radius:12px;border:1px solid rgba(0,0,0,.12);background:#fff}.search .i{position:absolute;left:10px;top:50%;transform:translateY(-50%);opacity:.45}.clear-btn{position:absolute;right:8px;top:50%;transform:translateY(-50%);width:24px;height:24px;border:none;background:0 0;cursor:pointer;border-radius:50%;display:flex;align-items:center;justify-content:center;color:var(--muted);transition:all .2s ease}.clear-btn:hover{background:rgba(0,0,0,.08);color:var(--text)}.convs{margin-top:12px;display:flex;flex-direction:column;gap:6px}.conv{display:flex;flex-direction:column;align-items:flex-start;gap:4px;padding:10px;border-radius:12px;background:#fff;border:1px solid rgba(0,0,0,.06);cursor:pointer}.conv:hover{border-color:rgba(0,0,0,.15)}.conv.active{outline:2px solid rgba(139,92,246,.25)}.conv .name{font-weight:600;font-size:14px;line-height:1.3;width:100%}.conv .time{color:var(--muted);font-size:12px;line-height:1.2}.results{margin-top:8px;display:none}.results.show{display:block}.result{padding:12px;margin:8px 0;border-radius:12px;background:linear-gradient(135deg,#fff,#f7fbff);border:1px solid rgba(0,0,0,.06);cursor:pointer;transition:all .2s ease}.result:hover{background:linear-gradient(135deg,#f8f9ff,#f0f4ff);border-color:rgba(139,92,246,.2);transform:translateY(-1px);box-shadow:0 4px 12px rgba(0,0,0,.1)}.result .meta{font-size:12px;color:var(--muted);display:flex;justify-content:space-between;align-items:center;margin-bottom:6px}.result .conv-title{font-weight:600;color:var(--brand);font-size:13px}.result .snippet{font-size:14px;line-height:1.4}.main{display:flex;flex-direction:column;height:100vh;min-width:0;width:100%}.chat-container{display:flex;flex-direction:column;height:100%;min-width:0;width:100%;overflow:auto}.chat{flex:1 1 auto;padding:16px;max-width:min(100%,1000px);margin:0 auto;min-width:0}.empty{color:var(--muted);text-align:center;padding:40px}.msg{margin:16px 0}.timestamp{font-size:12px;color:var(--muted);margin:6px 4px}.role{display:flex;gap:10px;align-items:flex-start;width:100%;min-width:0}.role>*{min-width:0;max-width:100%}.bubble{max-width:100%;padding:12px 14px;border-radius:18px;box-shadow:var(--shadow);background:var(--bubble-user);border:1px solid rgba(0,0,0,.06)}.assistant{width:100%;padding:0}.assistant .md{background:#fff;border:1px solid rgba(0,0,0,.06);border-radius:14px;padding:12px;box-shadow:var(--shadow);position:relative}.role.user{justify-content:flex-end}.role.user .bubble{max-width:61.8%;margin-left:auto}.msg.user .timestamp{text-align:right}.bubble-footer{display:flex;align-items:center;gap:6px;align-self:flex-end;flex-wrap:nowrap;font-size:12px}.model-info{color:var(--muted);margin:0}.branch-switcher{display:flex;align-items:center;gap:6px;padding:0;margin:0}.branch-btn{width:20px;height:20px;line-height:20px;border:none;background:0 0;color:var(--muted);cursor:pointer;border-radius:8px;display:flex;align-items:center;justify-content:center;transition:all .2s ease}.branch-btn:hover:not(:disabled){background:rgba(139,92,246,.1);color:var(--brand)}.branch-btn:active:not(:disabled){transform:scale(.95)}.branch-btn:disabled{opacity:.3;cursor:not-allowed}.branch-counter{font-weight:500;color:var(--muted);padding:0 4px;min-width:24px;text-align:center}#windowInfo:hover{background:rgba(139,92,246,.1);color:var(--brand)}#windowInfo:active{transform:scale(.95)}.text-box{background:#fff;border:1px solid rgba(0,0,0,.06);border-radius:14px;padding:12px;box-shadow:var(--shadow);position:relative;white-space:pre-wrap}.md{white-space:normal;word-wrap:break-word;overflow-wrap:break-word;hyphens:auto}.md h1,.md h2,.md h3{line-height:1.25;margin:16px 0 8px 0}.md h1{font-size:1.4rem;font-weight:700}.md h2{font-size:1.25rem;font-weight:600}.md h3{font-size:1.12rem;font-weight:600}.md pre{background:#4f3356c9;color:#f5f7ff;padding:14px;border-radius:12px;overflow-x:auto;overflow-y:visible;border:1px solid rgba(255,255,255,.08);margin:12px 0;word-break:break-all}.md code{white-space:pre-wrap;font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;background:#f7f7fb;border:1px solid rgba(0,0,0,.08);padding:.15em .35em;border-radius:6px;font-size:.9em;word-break:break-all}.md pre code{background:0 0;border:none;color:inherit;padding:0;font-size:.9em}.md ol,.md ul{padding-left:1.2rem;margin:0}.md li{margin:4px 0}.md blockquote{border-left:4px solid #e3d7ff;margin:0;padding:0 10px;background:0 0}.md code blockquote{border-left:none;padding:0;background:0 0}.md hr{border:none;height:2px;background:linear-gradient(90deg,transparent,rgba(139,92,246,.4),rgba(34,211,238,.4),transparent);margin:24px 0;border-radius:1px;box-shadow:0 1px 3px rgba(139,92,246,.1)}.md p{margin:12px 0;white-space:pre-wrap}.markdown-table{width:100%;border-collapse:collapse;margin:12px 0;border-radius:8px;overflow:hidden;box-shadow:0 2px 8px rgba(0,0,0,.08);table-layout:auto}.markdown-table th{background:linear-gradient(135deg,#f8f9ff,#f0f4ff);padding:10px 12px;text-align:left;font-weight:600;border-bottom:2px solid #e3d7ff;color:var(--text);word-break:break-all}.markdown-table td{padding:8px 12px;border-bottom:1px solid rgba(0,0,0,.06);background:#fff;word-break:break-all}.markdown-table tr:hover td{background:#f8f9fa}.markdown-table tr:last-child td{border-bottom:none}.highlight{animation:flash 1.5s ease}@keyframes flash{0%{background:rgba(255,240,255,.9)}100%{background:0 0}}.thumbnails-container{display:flex;flex-wrap:wrap;gap:8px;margin-top:12px;margin-bottom:12px;max-width:100%}.msg.user .thumbnails-container{justify-content:flex-end;max-width:61.8%;margin-left:auto}.thumbnail{width:80px;height:80px;object-fit:cover;border-radius:8px;border:2px solid rgba(0,0,0,.1);cursor:pointer;transition:all .2s ease;box-shadow:0 2px 8px rgba(0,0,0,.1)}.thumbnail:hover{transform:scale(1.05);border-color:var(--brand);box-shadow:0 4px 12px rgba(139,92,246,.3)}.image-modal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.8);display:flex;align-items:center;justify-content:center;z-index:1000;opacity:0;pointer-events:none;transition:opacity .3s ease}.image-modal.show{opacity:1;pointer-events:auto}.image-modal-content{max-width:90%;max-height:90%;position:relative}.image-modal img{max-width:100%;max-height:100%;border-radius:12px;box-shadow:0 20px 40px rgba(0,0,0,.5)}.image-modal-close{position:absolute;top:-40px;right:0;background:rgba(255,255,255,.9);border:none;border-radius:50%;width:32px;height:32px;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:18px;color:#333;transition:all .2s ease}.image-modal-close:hover{background:#fff;transform:scale(1.1)}.assistant .thumbnail{width:auto;height:auto;max-width:100%;max-height:300px;object-fit:contain;border-radius:8px;border:2px solid rgba(0,0,0,.1);cursor:pointer;transition:all .2s ease;box-shadow:0 2px 8px rgba(0,0,0,.1)}.footer{padding:6px 14px;font-size:12px;color:var(--muted);text-align:center}.backdrop{position:fixed;inset:0;background:rgba(16,12,24,.32);backdrop-filter:blur(2px);opacity:0;pointer-events:none;transition:opacity .2s ease;z-index:15}.backdrop.show{opacity:1;pointer-events:auto}@media (max-width:900px){.main{width:100vw}.app{grid-template-columns:1fr}.sidebar{position:fixed;left:0;top:0;bottom:0;width:76vw;max-width:340px;transform:translateX(-102%);transition:transform .25s ease;z-index:20;box-shadow:8px 0 24px rgba(0,0,0,.12)}.sidebar.open{transform:translateX(0)}.toggle{display:inline-flex}.brand{font-size:15px}.main{position:relative}.chat{padding:12px;max-width:100%;overflow-x:hidden}.bubble{max-width:85%;padding:10px 12px;font-size:16px}.assistant .md{padding:10px}.md{font-size:16px;line-height:1.5}.md h1{font-size:1.2rem}.md h2{font-size:1.1rem}.md h3{font-size:1rem}.md pre{padding:10px;font-size:14px;overflow-x:auto}.md code{font-size:14px;padding:.1em .25em}.markdown-table{font-size:14px}.markdown-table td,.markdown-table th{padding:6px 8px}.md a{word-break:break-all}.role.user .bubble{max-width:75%}.conv{padding:8px;gap:3px}.conv .name{font-size:14px}.conv .time{font-size:11px}}@media (max-width:480px){.chat{padding:8px}.bubble{max-width:90%;padding:8px 10px}.assistant .md{padding:8px}.md{font-size:16px}.md h1{font-size:1.1rem}.md h2{font-size:1rem}.md h3{font-size:.95rem}.role.user .bubble{max-width:80%}.md pre{font-size:14px;padding:8px}.md code{font-size:14px}.markdown-table{font-size:14px}.markdown-table td,.markdown-table th{padding:4px 6px}}</style><meta name=author content=å¼¥é›…Miaaa@RedNote><div class=app><aside class=sidebar id=sidebar><div class=side-inner><div class=picker><label>é€‰æ‹© ChatGPT ç›®å½•æˆ– JSON æ–‡ä»¶</label> <label class=btn><input id=pickDir type=file webkitdirectory multiple=multiple>ğŸ“ å¯¼å…¥ç›®å½•</label> <label class=btn><input id=pickFile type=file accept=application/json>ğŸ§¾ å¯¼å…¥ conversations.json</label></div><div class=search><span class=i>ğŸ”</span> <input id=searchBox placeholder="åœ¨æ‰€æœ‰çª—å£ä¸­æœç´¢â€¦ å›è½¦ç¡®è®¤"> <button id=clearSearch class=clear-btn style=display:none>âœ•</button></div><div id=searchResults class=results></div><h4 style="margin:10px 2px">çª—å£åˆ—è¡¨</h4><div id=convList class=convs></div></div></aside><div class=backdrop id=backdrop></div><main class=main><header><button class=toggle id=toggleBtn><div class=hamburger><span></span><span></span><span></span></div></button><div class=brand id=brandTitle>ChatGPT èŠå¤©è®°å½•æŸ¥çœ‹å™¨</div><button id=windowInfo style="margin-left:auto;background:0 0;border:none;color:var(--muted);font-size:14px;font-weight:800;cursor:pointer;padding:4px 8px;border-radius:4px;transition:background-color .2s;display:none" title=çª—å£è¯¦æƒ…>â“˜</button></header><div class=chat-container><section id=chat class=chat><div class=empty>è¯·é€‰æ‹©ç›®å½•æˆ– JSON æ–‡ä»¶ã€‚</div></section></div><div class=footer onmouseover=showCopyright() onmouseout=hideCopyright()>æœ¬åœ°æµè§ˆå™¨è§£ææ¸²æŸ“ï¼Œä¸ä¸Šä¼ ä»»ä½•æ•°æ®ã€‚<div class=footer-item style=display:none><div class=copyright>Copyright Â© 2025 å¼¥é›…Miaaa@RedNote. All rights reserved.</div></div></div></main><div id=windowDetailModal style=display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.5);z-index:1000;justify-content:center;align-items:center><div style="background:var(--bg);border:1px solid var(--border);border-radius:8px;max-width:500px;max-height:80vh;box-shadow:0 4px 20px rgba(0,0,0,.3);display:flex;flex-direction:column"><div style="display:flex;justify-content:space-between;align-items:center;padding:20px 20px 15px 20px;flex-shrink:0"><h3 style=margin:0;color:var(--text)>â“˜çª—å£è¯¦æƒ…</h3><button id=closeModal style="background:0 0;border:none;font-size:20px;cursor:pointer;color:var(--muted);padding:0;width:24px;height:24px;display:flex;align-items:center;justify-content:center">Ã—</button></div><div id=modalContent style="color:var(--text);line-height:1.5;padding:0 20px 20px 20px;overflow-y:auto;flex:1;min-height:0"></div></div></div></div><script>const $=e=>document.querySelector(e);function showCopyright(){$(".footer-item").style.display="block"}function hideCopyright(){$(".footer-item").style.display="none"}!function(){const e=$("#convList"),t=$("#chat"),n=$(".chat-container"),s=$("#searchBox"),a=$("#searchResults"),i=$("#windowInfo"),r=$("#clearSearch");let c=[],l=[],o=[],d=null,m=null;const h=$("#sidebar"),p=$("#backdrop");function u(e){h.classList.toggle("open",e),p&&p.classList.toggle("show",e),document.body.style.overflow=e?"hidden":""}$("#toggleBtn").addEventListener("click",()=>u(!h.classList.contains("open"))),p&&p.addEventListener("click",()=>u(!1)),document.addEventListener("keydown",e=>{"Escape"===e.key&&(a.classList.contains("show")?(a.classList.remove("show"),r.style.display="none"):u(!1))});let g=0,f=0;function v(t){let n;try{n=JSON.parse(t)}catch(e){return void alert("JSON è§£æå¤±è´¥: "+e.message)}Array.isArray(n)||(n=[n]),c=n.map((e,t)=>({id:"c"+t,title:e.title||`æœªå‘½åä¼šè¯ ${t+1}`,create_time:e.create_time?Number(e.create_time):0,update_time:e.update_time?Number(e.update_time):0,raw:e})),c.sort((e,t)=>(t.create_time||0)-(e.create_time||0)),o=[],c.forEach(e=>{const t=e.raw.mapping||{},n=Object.values(t),s=[];for(const e of n){const n=b(e,t);n&&("user"===n.role||"assistant"===n.role)&&n.text&&s.push(n)}s.sort((e,t)=>(e.time||0)-(t.time||0)),s.forEach((t,n)=>{o.push({convId:e.id,convTitle:e.title,id:`msg-${t.id||n}`,role:t.role,text:t.text,time:t.time})})}),e.innerHTML="",c.forEach(t=>{const n=document.createElement("div");n.className="conv",n.dataset.id=t.id;const s=new Date(1e3*(t.create_time||0));n.innerHTML=`<div class="name">${T(t.title)}</div><div class="time">${k(s)}</div>`,n.addEventListener("click",()=>y(t.id,!0,!0)),e.appendChild(n)}),c.length?y(c[0].id):($("#brandTitle").textContent="ChatGPT èŠå¤©è®°å½•æŸ¥çœ‹å™¨",i.style.display="none")}function b(e,t){const n=e&&e.message;if(!n||!n.author)return null;const s=n.author.role,a=n.content||{};let i="",r=[];if(Array.isArray(a.parts))for(const e of a.parts)"string"==typeof e?r.push(e):"object"==typeof e&&"text"in e&&"string"==typeof e.text&&r.push(e.text);return r.length||"string"!=typeof a.text||r.push(a.text),i=r.join("\n").trim(),{id:n.id||e.id,time:n.create_time?Number(n.create_time):null,role:s,text:i}}function y(t,s=!0,a=!1){d=t,e.querySelectorAll(".conv").forEach(e=>e.classList.toggle("active",e.dataset.id===t));const r=c.find(e=>e.id===t),l=$("#brandTitle");r?(l.textContent=`ChatGPT èŠå¤©è®°å½• Â· ${r.title}`,i.style.display="block"):i.style.display="none",C(r.raw,!0),s&&u(!1),a&&(n.scrollTop=0)}document.addEventListener("touchstart",e=>{g=e.changedTouches[0].screenX}),document.addEventListener("touchend",e=>{f=e.changedTouches[0].screenX;g-f>50&&h.classList.contains("open")&&u(!1)}),$("#pickDir").addEventListener("change",async e=>{m=Array.from(e.target.files||[]);const t=m.find(e=>"conversations.json"===e.name.toLowerCase());if(!t)return void alert("åœ¨æ‰€é€‰ç›®å½•ä¸­æœªå‘ç° conversations.json");v(await t.text())}),$("#pickFile").addEventListener("change",async e=>{const t=e.target.files&&e.target.files[0];if(!t)return;v(await t.text())});const x=$("#windowDetailModal"),_=$("#modalContent"),E=$("#closeModal");function L(){x.style.display="none"}i.addEventListener("click",function(){if(!d)return;const e=c.find(e=>e.id===d);if(!e||!e.raw||!e.raw.mapping)return;const t=e.raw.mapping;let n=null;for(const e in t){const s=t[e];if(s.message&&s.message.content&&"user_editable_context"===s.message.content.content_type){n=s.message;break}}let s='<div style="margin-bottom:20px;">';if(n&&n.metadata&&n.metadata.user_context_message_data){const e=T(n.metadata.user_context_message_data.about_user_message),t=T(n.metadata.user_context_message_data.about_model_message);e&&null!=e&&""!=e.trim()&&"undefined"!=e.trim()&&(s+="<h4>å…³äºç”¨æˆ·</h4>",s+='<div class="text-box">',s+=e,s+="</div>"),t&&null!=t&&""!=t.trim()&&"undefined"!=t.trim()&&(s+="<h4>è‡ªå®šä¹‰è®¾ç½®</h4>",s+='<div class="text-box">',s+=t,s+="</div>")}else s+='<div style="color:var(--muted); font-style:italic;">æœªæ‰¾åˆ°å…³äºç”¨æˆ·å’Œè‡ªå®šä¹‰è®¾ç½®çš„ä¿¡æ¯</div>';s+="</div>",_.innerHTML=s,x.style.display="flex"}),E.addEventListener("click",L),x.addEventListener("click",e=>{e.target===x&&L()});let w=new Map;function C(e,n=!1){const s=e.mapping||{},a=Object.values(s);function i(e,t=null){const n=s[e];if(!n||!n.message)return null;const a=n.message,i=a.author?.role,r=a.content||{};let c="",l=[],o=[];if("thoughts"===r.content_type)for(const e of r.thoughts)l.push("#### Thinking: "+e.summary+"\n"),l.push(e.content);else if("code"===r.content_type);else if(Array.isArray(r.parts)){"bio"===a.recipient&&l.push("#### Update Memory: \n");for(const e of r.parts)if("object"==typeof e&&"image_asset_pointer"===e.content_type&&"user"===i){const t=e.asset_pointer.split("/").pop();o.push(`${t}`)}else if("string"==typeof e&&e.includes("prompt")&&!1===a.end_turn){let e=n.children[0];for(;e;){const t=s[e];if("tool"!=t.message.author.role)break;if(t.message.content.parts&&t.message.content.parts.find(e=>"image_asset_pointer"===e.content_type)){const e=t.message.content.parts.find(e=>"image_asset_pointer"===e.content_type).asset_pointer.split("/").pop();o.push(e)}e=t.children[0]}}else"object"==typeof e&&"text"in e&&"string"==typeof e.text?l.push(e.text):l.push(e)}else l.push(r.text);c=l.join("\n").trim();const d=n.children.length>1;let m=w.get(e)||0;return d&&m>=n.children.length&&(m=0),{id:a.id||e,display:(""!=c.trim()||o.length>0)&&("user"===i||"assistant"===i),time:a.create_time?Number(a.create_time):null,model:a.metadata?.model_slug,children:n.children,nextChildId:d&&n.children?n.children[m]:n.children&&n.children[0],role:i,text:c,parentId:t,hasBranches:d,branchIndex:m,images:o}}let r;if(n){const e=function(){let e=null,t=0;for(const n of a){const s=n&&n.message;if(s&&s.create_time){const a=Number(s.create_time);a>t&&(t=a,e=n.id)}}return e}();if(!e)return void(t.innerHTML='<div class="empty">æ²¡æœ‰æ‰¾åˆ°å¯æ˜¾ç¤ºçš„å¯¹è¯ã€‚</div>');const n=function(e){const t=[];let n=e;for(;n;){const e=s[n];if(!e)break;if(t.unshift(n),!e.parent)break;n=e.parent}return t}(e);!function(e){w.clear();for(let t=0;t<e.length-1;t++){const n=e[t],s=e[t+1],a=i(n);if(a&&a.children&&a.children.length>1){const e=a.children.indexOf(s);e>=0&&w.set(n,e)}}}(n),r=n[0];const c=s[r];c&&!c.message&&c.children&&c.children.length>0&&(r=c.children[0])}else{for(const e of a){const t=e&&e.message;if(t&&(t.author&&"user"===t.author.role||e.children&&e.children.length>1)){r=e.id;break}}if(!r)return void(t.innerHTML='<div class="empty">æ²¡æœ‰æ‰¾åˆ°å¯æ˜¾ç¤ºçš„å¯¹è¯ã€‚</div>')}let c=function(e){const t=[];let n=e;for(;n;){const e=i(n);if(!e)break;t.push(e),n=e.nextChildId}return t}(r);t.innerHTML="",l=[];let o=null;c.forEach((n,s)=>{if(!n.display)return void(n.hasBranches&&(o=n.id));const a=document.createElement("article");a.className="msg "+n.role,a.id="msg-"+(n.id||s);let r=null;if(n.images.length>0){r=document.createElement("div"),r.className="thumbnails-container";for(const e of n.images){const t=document.createElement("img");let n=null;if(m&&(n=m.find(t=>t.name.includes(e))),n){const s=new FileReader;s.onload=n=>{t.src=n.target.result,t.className="thumbnail",t.alt=e,t.addEventListener("click",()=>{M(t.src,e)}),t.onerror=()=>{t.style.display="none";const e=document.createElement("div");e.className="text",e.textContent="å›¾ç‰‡åŠ è½½å¤±è´¥",r.appendChild(e)},r.appendChild(t)},s.onerror=()=>{const e=document.createElement("div");e.className="text",e.textContent="å›¾ç‰‡è¯»å–å¤±è´¥",r.appendChild(e)},s.readAsDataURL(n)}else{const e=document.createElement("div");e.className="text",e.textContent="æœªæ‰¾åˆ°å›¾ç‰‡ï¼Œè¯·å¯¼å…¥æ•´ä¸ªç›®å½•ä»¥æ˜¾ç¤ºå›¾ç‰‡",r.appendChild(e)}}}const c=document.createElement("div");c.className="role "+n.role;const d=document.createElement("div");d.className="user"===n.role?"bubble":"assistant";const h=document.createElement("div");h.className="md",h.innerHTML=function(e){if(!e)return"";let t=e;const n=[];t=T(t),t=t.replace(/```[ \t]*([^\n`]*)\r?\n([\s\S]*?)(?:\r?\n?```|$)/g,(e,t,s)=>(n.push({lang:t,code:s}),`__CODE_BLOCK_${n.length-1}__`)),t=t.replace(/(\|.*\|[\r\n]+)+\|.*\|/g,e=>{const t=e.trim().split("\n");if(t.length<2)return e;const n=t[0],s=t.slice(2),a=n.split("|").slice(1,-1).map(e=>e.trim()),i=s.map(e=>e.split("|").slice(1,-1).map(e=>e.trim()));let r='<table class="markdown-table"><thead><tr>';return a.forEach(e=>{r+=`<th>${e}</th>`}),r+="</tr></thead><tbody>",i.forEach(e=>{r+="<tr>",e.forEach(e=>{r+=`<td>${e}</td>`}),r+="</tr>"}),r+="</tbody></table>",r}),t=t.replace(/^[-*_]{3,}$/gm,"<hr>").replace(/^\s{0,3}((?:>|&gt;)\s*){1,3}(.+)$/gm,"<blockquote>$2</blockquote>").replace(/^####\s?(.*)$/gm,"<h4>$1</h4>").replace(/^###\s?(.*)$/gm,"<h3>$1</h3>").replace(/^##\s?(.*)$/gm,"<h2>$1</h2>").replace(/^#\s?(.*)$/gm,"<h1>$1</h1>").replace(/^(\d+)\.\s+(.*)$/gm,'<ol start="$1"><li>$2</li></ol>').replace(/^[-*]\s+(.*)$/gm,"<ul><li>$1</li></ul>").replace(/^\s+[-*]\s+(.*)$/gm,'<ul style="margin-left: 1.2rem;"><li>$1</li></ul>').replace(/<\/ol>\s*<ol[^>]*>/g,"").replace(/<\/ul>\s*<ul[^>]*>/g,"").replace(/<li>(.*?)<\/li>\s*<li>/g,"<li>$1</li><li>").replace(/!\[([^\]]*)\]\(([^)]+)\)/g,'<img alt="$1" src="$2" style="max-width:100%; border-radius:10px; border:1px solid rgba(0,0,0,.06)"/>').replace(/\[([^\]]+)\]\(([^)]+)\)/g,'<a href="$2" target="_blank" rel="noopener">$1</a>').replace(/\*\*([^*]+)\*\*/g,"<strong>$1</strong>").replace(/\*([^*]+)\*/g,"<em>$1</em>").replace(/`([^`]+)`/g,"<code>$1</code>").replace(/\ue200([a-zA-Z]+)\ue202.*\ue201/g,"ğŸŒ"),t=t.replace(/\n{2,}/g,e=>{const n=t.substring(0,t.indexOf(e)),s=(n.match(/<table/g)||[]).length,a=(n.match(/<\/table>/g)||[]).length,i=(n.match(/<pre>/g)||[]).length,r=(n.match(/<\/pre>/g)||[]).length;return s>a||i>r?"\n":"</p><p>"}),n.forEach((e,n)=>{t=t.replace(`__CODE_BLOCK_${n}__`,`<pre><code class="language-${e.lang||"text"}">${e.code.replace(/\n$/,"")}</code></pre>`)}),t=t.replace(/<p>\s*<\/p>\s*<hr>/g,"<hr>").replace(/<hr>\s*<p>\s*<\/p>/g,"<hr>"),t.startsWith("<p>")||t.startsWith("<hr>")||(t=`<p>${t}</p>`);return t=t.replace(/<p>\s*<\/p>/g,""),t}(n.text);const p=document.createElement("div");p.className="bubble-footer";const u=document.createElement("div");if(u.className="timestamp",u.textContent=n.time?k(new Date(1e3*n.time),!0):"æ—¶é—´æœªçŸ¥",p.appendChild(u),"assistant"===n.role&&n.model){const e=document.createElement("div");e.className="model-info",e.innerHTML=n.model,p.appendChild(e)}if(d.appendChild(h),null!=o){const t=i(o);branchSwitcher=document.createElement("div"),branchSwitcher.className="branch-switcher";const n=document.createElement("button");n.className="branch-btn prev",n.innerHTML="â€¹",n.disabled=0===t.branchIndex;const s=document.createElement("span");s.className="branch-counter",s.textContent=`${t.branchIndex+1}/${t.children.length}`;const a=document.createElement("button");a.className="branch-btn next",a.innerHTML="â€º",a.disabled=t.branchIndex===t.children.length-1;const r=n=>{n>=0&&n<t.children.length&&(w.set(t.id,n),C(e,!1))};n.addEventListener("click",()=>r(t.branchIndex-1)),a.addEventListener("click",()=>r(t.branchIndex+1)),branchSwitcher.appendChild(n),branchSwitcher.appendChild(s),branchSwitcher.appendChild(a),p.appendChild(branchSwitcher),o=null}n.hasBranches&&(o=n.id),c.appendChild(d),r&&("user"===n.role?a.appendChild(r):h.appendChild(r)),h.appendChild(p),a.appendChild(c),t.appendChild(a),l.push({id:a.id,role:n.role,text:n.text,time:n.time,el:a})}),c.length||(t.innerHTML='<div class="empty">è¿™ä¸ªä¼šè¯é‡Œæ²¡æœ‰å¯æ˜¾ç¤ºçš„ user/assistant æ¶ˆæ¯ã€‚</div>')}function k(e,t){if(!(e instanceof Date)||isNaN(e))return"æ—¶é—´æœªçŸ¥";const n=e=>String(e).padStart(2,"0"),s=e.getFullYear(),a=n(e.getMonth()+1),i=n(e.getDate()),r=n(e.getHours()),c=n(e.getMinutes()),l=n(e.getSeconds());return t?`${s}-${a}-${i} ${r}:${c}:${l}`:`${s}-${a}-${i}`}function T(e){return String(e).replace(/[&<>"']/g,e=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}[e]))}function N(e){e.classList.add("highlight"),setTimeout(()=>e.classList.remove("highlight"),1600)}function M(e,t){const n=document.createElement("div");n.className="image-modal";const s=document.createElement("div");s.className="image-modal-content";const a=document.createElement("img");a.src=e,a.alt=t;const i=document.createElement("button");i.className="image-modal-close",i.innerHTML="Ã—",i.addEventListener("click",()=>{n.classList.remove("show"),setTimeout(()=>{document.body.removeChild(n)},300)}),n.addEventListener("click",e=>{e.target===n&&(n.classList.remove("show"),setTimeout(()=>{document.body.removeChild(n)},300))}),s.appendChild(a),s.appendChild(i),n.appendChild(s),document.body.appendChild(n),setTimeout(()=>{n.classList.add("show")},10)}s.addEventListener("keydown",e=>{"Enter"===e.key&&function(e){if(!o.length||!e)return a.classList.remove("show"),void(a.innerHTML="");const t=new RegExp((s=e,s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")),"i"),n=[];var s;for(const e of o){const s=e.text.match(t);if(s){const t=s.index;n.push({convId:e.convId,convTitle:e.convTitle,id:e.id,time:e.time,snippet:e.text.slice(Math.max(0,t-60),Math.min(e.text.length,t+60))+"â€¦"})}}if(!n.length)return a.classList.add("show"),a.innerHTML='<div class="result">æœªæ‰¾åˆ°ç»“æœ</div>',void(r.style.display="flex");const i=new Map;n.forEach(e=>{(!i.has(e.convId)||e.time>i.get(e.convId).time)&&i.set(e.convId,e)});const c=Array.from(i.values()).sort((e,t)=>(t.time||0)-(e.time||0));a.classList.add("show"),r.style.display="flex",a.innerHTML=c.slice(0,20).map(e=>{const t=e.time?k(new Date(1e3*e.time),!0):"æ—¶é—´æœªçŸ¥";return`\n        <div class="result" data-conv-id="${e.convId}" data-msg-id="${e.id}">\n          <div class="meta">\n            <span class="conv-title">${T(e.convTitle)}</span>\n            <span class="time">${t}</span>\n          </div>\n          <div class="snippet">${T(e.snippet)}</div>\n\n        </div>\n      `}).join(""),a.querySelectorAll(".result").forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.convId,n=e.dataset.msgId;y(t,!1,!1),setTimeout(()=>{const e=document.getElementById(n);e?(e.scrollIntoView({behavior:"smooth",block:"start"}),N(e)):setTimeout(()=>{const e=document.getElementById(n);e&&(e.scrollIntoView({behavior:"smooth",block:"start"}),N(e))},200)},200)})})}(s.value.trim())}),r.addEventListener("click",()=>{s.value="",a.classList.remove("show"),r.style.display="none"}),s.addEventListener("input",()=>{r.style.display=s.value?"flex":"none"})}()</script>